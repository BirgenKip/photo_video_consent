<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Photography & Video Consent</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
:root {
  --aar-maroon: #7A0026;
  --aar-orange: #F47920;
  --light-bg: #faf7f8;
  --border-color: #ddd;
}

body {
  font-family: "Segoe UI", Arial, sans-serif;
  margin: 0;
  background: var(--light-bg);
  color: #333;
}

.container {
  max-width: 900px;
  margin: 20px auto;
  background: #fff;
  padding: 24px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

@media (max-width: 768px) {
  .container {
    margin: 0;
    padding: 16px;
  }
}

.logo-header {
  display: flex;
  justify-content: center;
  margin-bottom: 20px;
}

.logo-header img {
  max-width: 160px;
}

h1 {
  text-align: center;
  color: var(--aar-maroon);
  font-size: 22px;
}

.subtitle {
  text-align: center;
  font-size: 14px;
  margin-bottom: 25px;
}

h2 {
  color: var(--aar-maroon);
  border-left: 6px solid var(--aar-orange);
  padding-left: 10px;
  margin-top: 25px;
  font-size: 18px;
}

.section {
  margin-bottom: 25px;
}

label {
  font-weight: 600;
  display: block;
  margin-bottom: 5px;
}

input[type="text"],
input[type="date"] {
  width: 100%;
  padding: 12px;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  margin-bottom: 15px;
  font-size: 15px;
}

.checkbox-group label {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 10px;
}

canvas {
  width: 100%;
  height: auto;
  border: 2px dashed var(--aar-maroon);
  border-radius: 4px;
  background: #fff;
  touch-action: none;
}

button {
  background: var(--aar-maroon);
  color: #fff;
  border: none;
  padding: 14px;
  font-size: 16px;
  border-radius: 4px;
  width: 100%;
}

button:hover {
  background: var(--aar-orange);
}

.signature-actions button {
  width: auto;
  margin-top: 10px;
}

.note {
  font-size: 13px;
  background: #fff6ef;
  padding: 15px;
  border-left: 5px solid var(--aar-orange);
  margin-top: 20px;
}

.accordion {
  border-top: 2px solid var(--aar-maroon);
  margin-top: 25px;
  padding-top: 15px;
}

.accordion-title {
  text-align: center;
  font-weight: 600;
  cursor: pointer;
}

.accordion-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s ease;
}

.accordion-content.open {
  max-height: 900px;
}

.spinner {
  width: 28px;
  height: 28px;
  border: 3px solid #ccc;
  border-top: 3px solid #000;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}
.divider {
  margin: 25px 0;
  border: none;
  border-top: 1px solid #ddd;
}

  </style>
</head>

<body>
<div class="container">

  <div class="logo-header">
    <img src="/images/AAR Logo.png" alt="AAR Insurance Logo">
  </div>

  <h1>PHOTOGRAPHY AND VIDEO CONSENT FORM</h1>
  <div class="subtitle">AAR Insurance – Kenya Ltd (AIK)</div>

  <div class="section">
    <label>Event Name</label>
    <input id="eventName" type="text">

    <label>Venue</label>
    <input id="venue" type="text">

    <label>Date</label>
    <input id="eventDate" type="date">
  </div>

  <div class="section">
    <h2>Purpose and Intended Use</h2>
    <p>1. Photographers and/or videographers have been assigned to this event to capture imagery and videos that will be used for future promotion and marketing purposes by AAR Insurance – Kenya Ltd (AIK) and its affiliated third parties. </p>
    <p>2. This form asks you to consent to the use of photographs and video footage that features you, or a child in your care, in our communications.</p>
    <p>3. Your image or appearance in photography and video footage may be used in our printed publications for promotional purposes, in press releases, on our social media channels, in presentation materials and on our website. It may also appear in our advertising in the media or may be used by AAR Insurance – Kenya Ltd (AIK) contracted third parties for event-related promotion and marketing.</p>
    <p>4. It is likely that your image or appearance in photography video footage will be published on our online platforms and as such will be subject to international data transfer. This means that it can be viewed and accessed from anywhere in the world and potentially from a country that does not have adequate data protection laws in place</p>
    <p>5. The photographs and/or videos will remain the property of AAR Insurance – Kenya Ltd (AIK) and will only be used for promotional and marketing purposes.</p>
    <p>6. Your other personal data will remain strictly confidential.</p>
  </div>

  <div class="section">
    <h2>Individual Consent</h2>
    <p> Please tick the box(es) and sign below to provide consent
    I hereby provide my consent for the photos and/or video footage to be used in the Group’s promotional and marketing communications and publications relating to the event including on the AAR Insurance – Kenya Ltd (AIK) website, social media, press releases, print and advertising media.
    </p>
    <div class="checkbox-group">
      <label><input type="checkbox" id="forSelf"> For self</label>
      <label><input type="checkbox" id="forChild"> For child(ren)</label>
    </div>
  </div>

  <div class="section">
    <h2>Declaration</h2>
    <p>1. I have the right to withdraw this consent at any time by sending an email to communications@aar.co.ke. If this consent is withdrawn, AAR Insurance – Kenya Ltd will not use your photo and/or video footage in any new publications or materials.</p>
    <p>2. If the photos and/or video has already been published on print or social media prior to the withdrawal of this consent, they may be retained on existing publications and materials where it is not possible for AAR Insurance – Kenya Ltd (AIK) to withdraw/recall such publications and materials.</p>
    <p>3. I will not receive any compensation, royalties or any other form of payment for the use of the photos and/or video footage.</p>
    <p>4. The photos and/or video footage will be held by the AAR Insurance – Kenya Ltd (AIK) in accordance with the Data Protection Act, 2019.</p>
  </div>

  <div class="section">
    <label>Full Name</label>
    <input id="fullName" type="text">
  </div>

  <div class="section">
    <label>Signature</label>
    <canvas id="signature" width="600" height="180"></canvas>
    <div class="signature-actions">
      <button type="button" onclick="clearSignature()">Clear Signature</button>
    </div>
  </div>

   <div class="note">
    By signing above, you confirm that you have read, understood, and agreed to the terms outlined in this consent form.
  </div>

  <button onclick="submitForm()">Submit Consent</button>

  <div id="loadingIndicator" style="display:none; margin-top:15px; text-align:center;">
    <span>Submitting…</span><br>
    <span class="spinner"></span>
  </div>

  <div class="accordion">
  <div class="accordion-title" onclick="toggleMinorSection()">
    IF SUBJECT IS UNDER 18 YEARS (click to expand)
  </div>

  <div id="minorSection" class="accordion-content">
    <p>
      I confirm that I am the legal guardian of the child(ren) named below and
      that I am legally authorized to provide consent on their behalf.
    </p>

    <label for="childNames">Child Name(s)</label>
    <input id="childNames" type="text" placeholder="e.g. John Doe, Jane Doe">

    <label for="guardianName">Guardian Name</label>
    <input id="guardianName" type="text" placeholder="Full name">

    <label for="relationship">Relationship to Child</label>
    <input id="relationship" type="text" placeholder="e.g. Parent, Legal Guardian">

    <label>Guardian Signature</label>
    <div class="signature-wrapper">
      <canvas id="guardianSignature" width="600" height="180"></canvas>
    </div>

    <button type="button" onclick="clearGuardianSignature()">
  Clear Signature
</button>

<hr class="divider">

<button type="button" onclick="submitForm()" class="submit-btn">
  Submit Consent
</button>
  </div>
</div>

</div>

<script>
function setupSignature(canvas) {
  const ctx = canvas.getContext("2d");
  let drawing = false;

  const start = e => {
    drawing = true;
    ctx.beginPath();
    const p = getPos(e);
    ctx.moveTo(p.x, p.y);
  };

  const move = e => {
    if (!drawing) return;
    const p = getPos(e);
    ctx.lineTo(p.x, p.y);
    ctx.stroke();
  };

  const stop = () => drawing = false;

  const getPos = e => {
    const rect = canvas.getBoundingClientRect();
    const touch = e.touches ? e.touches[0] : e;
    return { x: touch.clientX - rect.left, y: touch.clientY - rect.top };
  };

  canvas.addEventListener("mousedown", start);
  canvas.addEventListener("mousemove", move);
  canvas.addEventListener("mouseup", stop);
  canvas.addEventListener("touchstart", start);
  canvas.addEventListener("touchmove", move);
  canvas.addEventListener("touchend", stop);

  return () => ctx.clearRect(0, 0, canvas.width, canvas.height);
}

const clearSignature = setupSignature(document.getElementById("signature"));
const clearGuardianSignature = setupSignature(document.getElementById("guardianSignature"));

function toggleMinorSection() {
  document.getElementById("minorSection").classList.toggle("open");
}

async function submitForm() {
  const loader = document.getElementById("loadingIndicator");
  loader.style.display = "block";

  try {
    const signatureCanvas = document.getElementById("signature");
    const guardianCanvas = document.getElementById("guardianSignature");

    const payload = {
      eventName: document.getElementById("eventName").value.trim(),
      venue: document.getElementById("venue").value.trim(),
      eventDate: document.getElementById("eventDate").value,
      fullName: document.getElementById("fullName").value.trim(),

      forSelf: document.getElementById("forSelf").checked,
      forChild: document.getElementById("forChild").checked,

      signature: signatureCanvas.toDataURL("image/png"),

      childNames: document.getElementById("childNames").value.trim(),
      guardianName: document.getElementById("guardianName").value.trim(),
      relationship: document.getElementById("relationship").value.trim(),

      childSignature: guardianCanvas.toDataURL("image/png")
    };

    const res = await fetch("/generate-pdf", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(payload)
    });

    const result = await res.json();

    if (!res.ok) {
      throw new Error(result.message || "Submission failed");
    }

    alert(result.message);
    location.reload();

  } catch (err) {
    alert(err.message || "Submission failed");
  } finally {
    loader.style.display = "none";
  }
}
</script>
</body>
</html>
